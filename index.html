order.status = status;
                saveOrders();
                
                // Chuẩn bị nội dung email dựa trên các dịch vụ đã chọn
                let serviceDetails = order.services.map(service => {
                    switch(service) {
                        case 'battery': return 'Thay pin';
                        case 'screen': return 'Thay màn hình';
                        case 'speaker': return 'Sửa loa';
                        case 'camera': return 'Sửa camera';
                        case 'charging': return 'Sửa cổng sạc';
                        default: return service;
                    }
                }).join(', ');

                // Tạo nội dung email chi tiết
                const emailContent = status === 'accepted' ? 
                    `Kính gửi ${order.name},\n\n` +
                    `Đơn hàng ${order.code} của bạn đã được chấp nhận và đang được xử lý.\n` +
                    `Thông tin chi tiết:\n` +
                    `- Thiết bị: ${order.deviceModel}\n` +
                    `- Dịch vụ: ${serviceDetails}\n` +
                    `- Thời gian tiếp nhận: ${new Date().toLocaleString()}\n\n` +
                    `Chúng tôi sẽ liên hệ với bạn qua số điện thoại ${order.phone} để thông báo chi tiết về thời gian và chi phí sửa chữa.\n\n` +
                    `Xin cảm ơn bạn đã sử dụng dịch vụ của chúng tôi.` :
                    `Kính gửi ${order.name},\n\n` +
                    `Rất tiếc, đơn hàng ${order.code} của bạn đã bị từ chối.\n` +
                    `Vui lòng liên hệ với chúng tôi qua hotline để được hỗ trợ thêm.\n\n` +
                    `Xin lỗi vì sự bất tiện này.`;
                
                // Giả lập gửi email
                console.log('Sending email to:', order.email);
                console.log('Email content:', emailContent);
                alert(`Email đã được gửi tới ${order.email}`);
                
                displayOrders();
            }
        }

        // Thêm tính năng tìm kiếm đơn hàng
        function searchOrders(query) {
            const searchResults = orders.filter(order => 
                order.code.toLowerCase().includes(query.toLowerCase()) ||
                order.name.toLowerCase().includes(query.toLowerCase()) ||
                order.phone.includes(query) ||
                order.email.toLowerCase().includes(query.toLowerCase()) ||
                order.deviceModel.toLowerCase().includes(query.toLowerCase())
            );
            displaySearchResults(searchResults);
        }

        function displaySearchResults(results) {
            const orderList = document.getElementById('orderList');
            orderList.innerHTML = '';
            results.forEach(order => {
                // Sử dụng lại logic hiển thị đơn hàng từ hàm displayOrders
                const orderElement = document.createElement('div');
                orderElement.className = 'order-item';
                orderElement.innerHTML = `
                    <strong>Mã đơn: ${order.code}</strong><br>
                    Khách hàng: ${order.name}<br>
                    SĐT: ${order.phone}<br>
                    Email: ${order.email}<br>
                    Thiết bị: ${order.deviceModel} (${order.deviceType})<br>
                    Dịch vụ: ${order.services.join(', ')}<br>
                    Mô tả thêm: ${order.request}<br>
                    Ngày tạo: ${order.date}<br>
                    Trạng thái: ${order.status}<br>
                    <div class="action-buttons">
                        ${order.status === 'pending' ? `
                            <button class="accept-btn" onclick="handleOrder('${order.code}', 'accepted')">Nhận đơn</button>
                            <button class="reject-btn" onclick="handleOrder('${order.code}', 'rejected')">Từ chối</button>
                        ` : ''}
                    </div>
                `;
                orderList.appendChild(orderElement);
            });
        }

        // Thêm thanh tìm kiếm vào panel nhân viên
        const staffPanel = document.getElementById('staffPanel');
        const searchBox = document.createElement('div');
        searchBox.className = 'form-group';
        searchBox.innerHTML = `
            <input type="text" id="searchInput" placeholder="Tìm kiếm đơn hàng..." 
                   onkeyup="searchOrders(this.value)" class="search-input">
        `;
        staffPanel.insertBefore(searchBox, staffPanel.firstChild.nextSibling);

        // Thêm style cho thanh tìm kiếm
        const style = document.createElement('style');
        style.textContent = `
            .search-input {
                padding: 8px;
                margin-bottom: 20px;
                border: 1px solid #ddd;
                border-radius: 4px;
                width: 100%;
            }

            .search-input:focus {
                outline: none;
                border-color: #4CAF50;
                box-shadow: 0 0 5px rgba(76, 175, 80, 0.2);
            }
        `;
        document.head.appendChild(style);

        // Xử lý sắp xếp đơn hàng theo thời gian
        function sortOrders(type = 'newest') {
            orders.sort((a, b) => {
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                return type === 'newest' ? dateB - dateA : dateA - dateB;
            });
            displayOrders();
        }

        // Thêm nút sắp xếp vào panel nhân viên
        const sortButtons = document.createElement('div');
        sortButtons.className = 'sort-buttons';
        sortButtons.innerHTML = `
            <button onclick="sortOrders('newest')" class="sort-btn">Mới nhất</button>
            <button onclick="sortOrders('oldest')" class="sort-btn">Cũ nhất</button>
        `;
        staffPanel.insertBefore(sortButtons, searchBox.nextSibling);

        // Thêm style cho nút sắp xếp
        const sortStyle = document.createElement('style');
        sortStyle.textContent = `
            .sort-buttons {
                margin-bottom: 20px;
                display: flex;
                gap: 10px;
            }

            .sort-btn {
                background-color: #666;
                padding: 8px 15px;
                font-size: 14px;
            }

            .sort-btn:hover {
                background-color: #555;
            }
        `;
        document.head.appendChild(sortStyle);

        // Load saved orders when page loads
        window.onload = function() {
            loadOrders();
        }
    </script>
</body>
</html>
